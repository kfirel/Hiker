"""
Validation module for user input
Includes settlement validation and day validation
"""

import re
import os
import json
from difflib import SequenceMatcher
from typing import Optional, Tuple, List, Set

# ×˜×¢×™× ×ª ×¨×©×™××ª ×™×©×•×‘×™× ××§×•×‘×¥ GeoJSON
def _load_settlements() -> Set[str]:
    """×˜×•×¢×Ÿ ××ª ×¨×©×™××ª ×”×™×©×•×‘×™× ××§×•×‘×¥ GeoJSON"""
    
    # × ×ª×™×‘ ×œ×§×•×‘×¥ ×”×™×©×•×‘×™×
    current_dir = os.path.dirname(os.path.abspath(__file__))
    geojson_file = os.path.join(current_dir, '..', 'metadata', 'settlements_list.geojson')
    
    try:
        with open(geojson_file, 'r', encoding='utf-8') as f:
            geojson_data = json.load(f)
            
        settlements = set()
        for feature in geojson_data.get('features', []):
            properties = feature.get('properties', {})
            # ×”×©×“×” ×¢× ×©× ×”×™×©×•×‘ ×”×•× MGLSDE_LOC
            settlement_name = properties.get('MGLSDE_LOC', '').strip()
            if settlement_name:
                settlements.add(settlement_name)
        
        if settlements:
            return settlements
    except FileNotFoundError:
        print(f"Warning: GeoJSON file not found: {geojson_file}")
    except Exception as e:
        print(f"Warning: Could not load settlements from GeoJSON: {e}")
    
    # ×¨×©×™××ª ×™×©×•×‘×™× ×‘×¡×™×¡×™×ª (fallback) - ×¨×§ ×’×‘×¨×¢×
    return {
        '×’×‘×¨×¢×',
    # ×¢×¨×™× ××¨×›×–×™×•×ª
    '×™×¨×•×©×œ×™×', '×ª×œ ××‘×™×‘', '×ª×œ ××‘×™×‘-×™×¤×•', '×—×™×¤×”', '×‘××¨ ×©×‘×¢', '×‘××¨-×©×‘×¢',
    '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', '×¤×ª×— ×ª×§×•×•×”', '×¤×ª×—-×ª×§×•×•×”', '××©×“×•×“', '× ×ª× ×™×”', '×—×•×œ×•×Ÿ',
    '×‘× ×™ ×‘×¨×§', '×¨××ª ×’×Ÿ', '×¨××ª-×’×Ÿ', '××©×§×œ×•×Ÿ', '×¨×—×•×‘×•×ª', '×‘×ª ×™×', '×‘×ª-×™×',
    '×›×¤×¨ ×¡×‘×', '×›×¤×¨-×¡×‘×', '×”×¨×¦×œ×™×”', '×—×“×¨×”', '××•×“×™×¢×™×Ÿ', '××•×“×™×¢×™×Ÿ-××›×‘×™×-×¨×¢×•×ª',
    '× ×¦×¨×ª', '× ×¦×¨×ª ×¢×™×œ×™×ª', '×œ×•×“', '×¨××œ×”', '×¢×›×•', '×¢×¤×•×œ×”', '×§×¨×™×™×ª ××ª×',
    '×¦×¤×ª', '×˜×‘×¨×™×”', '×‘×™×ª×¨ ×¢×™×œ×™×ª', '×§×¨×™×™×ª ×’×ª', '×§×¨×™×™×ª ××•×¦×§×™×Ÿ', '××•×¨ ×™×”×•×“×”',
    '×’×‘×¢×ª×™×™×', '×§×¨×™×™×ª ×‘×™××œ×™×§', '×§×¨×™×™×ª ×™×', '×§×¨×™×™×ª ×©××•× ×”', '×›×¨××™××œ', '×™×”×•×“',
    '×“×™××•× ×”', '×§×¨×™×™×ª ××œ××›×™', '×–×›×¨×•×Ÿ ×™×¢×§×‘', '×‘××§×” ××œ-×’×¨×‘×™×”', '××•× ××œ-×¤×—×',
    '×‘×™×ª ×©××©', '×¨×¢× × ×”', '××¨×™××œ', '××¢×œ×•×ª-×ª×¨×©×™×—×', '×§×¨×™×™×ª ××¨×‘×¢',
    
    # ×’×‘×¨×¢× - ×”×™×©×•×‘ ×”××¨×›×–×™ ×©×œ ×”×‘×•×˜!
    '×’×‘×¨×¢×',
    
    # ××–×•×¨×™×
    '×¦×¤×•×Ÿ', '×“×¨×•×', '××¨×›×–', '×©×¤×œ×”', '×™×¨×•×©×œ×™× ×•×”×¡×‘×™×‘×”', '×’×•×© ×“×Ÿ', '×”×©×¨×•×Ÿ',
    '×¢××§ ×™×–×¨×¢××œ', '×”×’×œ×™×œ', '×”×’×œ×™×œ ×”×¢×œ×™×•×Ÿ', '×”×’×œ×™×œ ×”×ª×—×ª×•×Ÿ', '×”× ×’×‘', '×¢×¨×‘×”',
    '×‘×§×¢×ª ×”×™×¨×“×Ÿ', '×¢××§ ×”×™×¨×“×Ÿ', '×”×›×¨××œ', '×’×œ×™×œ ××¢×¨×‘×™', '×¢××§ ×—×¤×¨', '×©×“×•×ª × ×’×‘',
    
    # ×¢×¨×™× × ×•×¡×¤×•×ª
    '×ª×œ ××•× ×“', '×™×‘× ×”', '×’×“×¨×”', '×©×•×”×', '××–×›×¨×ª ×‘×ª×™×”', '× ×¡ ×¦×™×•× ×”', '× ×¡-×¦×™×•× ×”',
    '×¨××ª ×”×©×¨×•×Ÿ', '×¨××ª-×”×©×¨×•×Ÿ', '×”×•×“ ×”×©×¨×•×Ÿ', '×”×•×“-×”×©×¨×•×Ÿ', '×¨×¢×•×ª', '××œ×¢×“',
    '×›×•×›×‘ ×™×¢×§×‘', '×‘×™×ª ×©××Ÿ', '××’×“×œ ×”×¢××§', '××’×“×œ-×”×¢××§', '×™×§× ×¢×', '××•×¤×§×™×',
    '× ×”×¨×™×”', '×˜×™×™×‘×”', '×©×¤×¨×¢×', '×¢×¨×¢×¨×”', '×¢×¨××‘×”', '×˜××¨×”',
    '×“××œ×™×ª ××œ-×›×¨××œ', '×©×“×¨×•×ª', '×¢×¨×“', '××™×œ×ª', '××¢×œ×” ××“×•××™×', '××¢×œ×”-××“×•××™×', '×‘×™×ª ××¨×™×”',
    '×’× ×™ ×ª×§×•×•×”', '×§×“×•××™×', '×¢×× ×•××œ', '××œ×¤×™ ×× ×©×”', '××‘×Ÿ ×™×”×•×“×”', '××‘×Ÿ-×™×”×•×“×”',
    '×§×¨×™×™×ª ×˜×‘×¢×•×Ÿ', '×§×¨×™×™×ª-×˜×‘×¢×•×Ÿ', '××¢×œ×•×ª', '××¢×œ×•×ª ×ª×¨×©×™×—×', '××¢×œ×•×ª-×ª×¨×©×™×—×',
    '×§×¨×™×™×ª ×©××•××œ', '×§×¨×™×™×ª-×©××•××œ', '×§×¨×™×™×ª ×¢×§×¨×•×Ÿ', '×§×¨×™×™×ª-×¢×§×¨×•×Ÿ',
    
    # ×™×©×•×‘×™× × ×•×¡×¤×™× ×‘×’×•×© ×“×Ÿ ×•××¨×›×–
    '×™×”×•×“-××•× ×•×¡×•×Ÿ', '××–×•×¨', '×§×¨×™×™×ª ××•× ×•', '×§×¨×™×™×ª-××•× ×•', '×¡×‘×™×•×Ÿ', '×¦×”×œ×”',
    '×¨××ª ××¤×¢×œ', '×¨××ª-××¤×¢×œ', '×’×‘×¢×ª ×©××•××œ', '×’×‘×¢×ª-×©××•××œ', '××•×¨ ×¢×§×™×‘×', '××•×¨-×¢×§×™×‘×',
    '×¨××ª ×™×©×™', '×¨××ª-×™×©×™', '×–×›×¨×•×Ÿ ×™×¢×§×‘', '××‘×©×¨×ª ×¦×™×•×Ÿ', '××‘×©×¨×ª-×¦×™×•×Ÿ',
    '××¢×‘×¨×•×ª', '×§×“×™××”', '×§×“×™××”-×¦×•×¨×Ÿ', '×¦×•×¨×Ÿ', '×¨××ª ×¨×–×™××œ', '×¨××ª-×¨×–×™××œ',
    
    # ×™×™×©×•×‘×™× ×‘×“×¨×•×
    '× ×ª×™×‘×•×ª', '××©×›×•×œ', '××˜×•×œ×”', '×§×¨×™×ª ×©××•× ×”', '×¨×”×˜', '×ª×œ ×©×‘×¢', '×œ×§×™×”', '×—×•×¨×”',
    '×©×“×” ×‘×•×§×¨', '×©×“×”-×‘×•×§×¨', '××¦×¤×” ×¨××•×Ÿ', '××¦×¤×”-×¨××•×Ÿ', '×™×¨×•×—×', '××™×ª×¨',
    '×œ×”×‘×™×', '×¢×•××¨', '××©××¨ ×”× ×’×‘', '××©××¨-×”× ×’×‘', '× ×™×¨ ×¢×•×–', '× ×™×¨-×¢×•×–',
    '×¡×¢×“', '×¢×™×Ÿ ×”×‘×©×•×¨', '×¢×™×Ÿ-×”×‘×©×•×¨', '×›×™×¡×•×¤×™×', '×’×‘×•×œ×•×ª', '× ×™×¨×™×',
    
    # ×™×™×©×•×‘×™× ×‘××–×•×¨ ×™×¨×•×©×œ×™×
    '×’×‘×¢×ª ×–××‘', '×’×‘×¢×ª-×–××‘', '×‘×™×ª ××œ', '×‘×™×ª-××œ', '×¤×¡×’×ª ×–××‘', '×¨××•×ª',
    '×’×™×œ×”', '× ×™×•×•×” ×™×¢×§×‘', '×¤×¡×’×•×ª', '×¢×¤×¨×”', '××¢×œ×” ××›××©', '××¢×œ×”-××›××©',
    '×›×•×›×‘ ×™×¢×§×‘', '×›×•×›×‘-×™×¢×§×‘', '×’×‘×¢×•×Ÿ ×”×—×“×©×”', '×’×‘×¢×•×Ÿ-×”×—×“×©×”', '××‘×• ×’×•×©',
    '××¢×œ×” ×”×—××™×©×”', '××¢×œ×”-×”×—××™×©×”', '×¦×•×¨ ×”×“×¡×”', '×¦×•×¨-×”×“×¡×”', '××‘×©×¨×ª ×¦×™×•×Ÿ',
    
    # ×™×™×©×•×‘×™× ×‘× ×’×‘ ×”××¢×¨×‘×™ (××–×•×¨ ×’×‘×¨×¢×)
    '×’×‘×¨×¢×', '× ×ª×™×‘×•×ª', '××•×¤×§×™×', '×©×“×¨×•×ª', '×¡×¢×“', '× ×™×¨ ×¢×•×–', '× ×™×¨-×¢×•×–',
    '×›×™×¡×•×¤×™×', '×’×‘×•×œ×•×ª', '× ×™×¨×™×', '×¢×™×Ÿ ×”×‘×©×•×¨', '×¢×™×Ÿ-×”×‘×©×•×¨', '××¤×œ×¡×™×',
    '×ª×œ××™×', '×©×™×‘×•×œ×™×', '××‘×§×™×¢×™×', '×–××¨×ª', '×“×§×œ', '×¢×œ×•××™×', '×—×•×œ×™×ª',
    '×›×¨××™×”', '×ª×§×•××”', '××‘×˜×—', '×©×œ×•××™×ª', '××’×Ÿ', '××•×¨×™×', '×¦××œ×™×',
    
    # ×™×™×©×•×‘×™× ×‘× ×’×‘ ×”××–×¨×—×™
    '×¢×¨×“', '×“×™××•× ×”', '×™×¨×•×—×', '××¦×¤×” ×¨××•×Ÿ', '××¦×¤×”-×¨××•×Ÿ', '××™×ª×¨', '×œ×”×‘×™×',
    '×¢×•××¨', '××©××¨ ×”× ×’×‘', '××©××¨-×”× ×’×‘', '×©×“×” ×‘×•×§×¨', '×©×“×”-×‘×•×§×¨',
    
    # ×§×™×‘×•×¦×™× ×•××•×©×‘×™× ××¨×›×–×™×™×
    '×™×¤×ª×—', '×¢×™×Ÿ ×’×“×™', '×¢×™×Ÿ-×’×“×™', '× ×—×©×•×œ×™×', '×©×“×•×ª ×™×', '××¢×’×Ÿ ××™×›××œ', '××¢×’×Ÿ-××™×›××œ',
    '×¢×™×Ÿ ×’×‘', '×¢×™×Ÿ-×’×‘', '×“×’× ×™×”', '×“×’× ×™×” ×', "×“×’× ×™×” ×‘'", '×™×’×•×¨', '××¢×™×™×Ÿ ×‘×¨×•×š',
    '×›×¤×¨ ×’×œ×¢×“×™', '×›×¤×¨-×’×œ×¢×“×™', '×× ×¨×”', '××¦×•×‘×”', '××©×“×•×ª ×™×¢×§×‘', '××©×“×•×ª-×™×¢×§×‘',
    '×’×™× ×•×¡×¨', '××’×“×œ', '×›× ×¨×ª', '×“×’× ×™×” ×', "×“×’× ×™×” ×‘'", '×‘×™×ª ×–×¨×¢', '×‘×™×ª-×–×¨×¢',
    
    # ×™×™×©×•×‘×™× ×‘×’×œ×™×œ
    '×¦×¤×ª', '×›×¨××™××œ', '× ×”×¨×™×”', '××¢×œ×•×ª', '××¢×œ×•×ª-×ª×¨×©×™×—×', '×§×¨×™×™×ª ×©××•× ×”',
    '××˜×•×œ×”', '×¨××© ×¤×™× ×”', '×¨××©-×¤×™× ×”', '×—×¦×•×¨ ×”×’×œ×™×œ×™×ª', '×—×¦×•×¨-×”×’×œ×™×œ×™×ª',
    '××¢×™×œ×™×', '××¢×™×œ×™×”', '×¤×§×™×¢×™×Ÿ', '×‘×™×ª ×’×Ÿ', '×‘×™×ª-×’×Ÿ', '×›×¨××™××œ',
    
    # ×™×™×©×•×‘×™× ×‘×©×¨×•×Ÿ
    '× ×ª× ×™×”', '×”×¨×¦×œ×™×”', '×¨×¢× × ×”', '×”×•×“ ×”×©×¨×•×Ÿ', '×”×•×“-×”×©×¨×•×Ÿ', '×¨××ª ×”×©×¨×•×Ÿ', '×¨××ª-×”×©×¨×•×Ÿ',
    '×›×¤×¨ ×¡×‘×', '×›×¤×¨-×¡×‘×', '×¨×¢× × ×”', '×§×“×™××”', '×§×“×™××”-×¦×•×¨×Ÿ', '×¦×•×¨×Ÿ',
    '×ª×œ ××•× ×“', '×–×›×¨×•×Ÿ ×™×¢×§×‘', '××¢×‘×¨×•×ª', '×§×™×¡×¨×™×”', '××•×¨ ×¢×§×™×‘×', '××•×¨-×¢×§×™×‘×',
    
    # ×™×™×©×•×‘×™× ×‘×¢××§
    '×¢×¤×•×œ×”', '×¢×¤×•×œ×”', '×™×§× ×¢×', '××’×“×œ ×”×¢××§', '××’×“×œ-×”×¢××§', '×‘×™×ª ×©××Ÿ',
    '×¢××§ ×™×–×¨×¢××œ', '× ×”×œ×œ', '×›×¤×¨ ×ª×‘×•×¨', '×›×¤×¨-×ª×‘×•×¨', '×›×¤×¨ ××¡×¨×™×§', '×›×¤×¨-××¡×¨×™×§',
    
    # ×™×™×©×•×‘×™× ×‘××¨×›×–
    '×ª×œ ××‘×™×‘', '×ª×œ ××‘×™×‘-×™×¤×•', '×¨××ª ×’×Ÿ', '×¨××ª-×’×Ÿ', '×’×‘×¢×ª×™×™×', '×‘× ×™ ×‘×¨×§',
    '×—×•×œ×•×Ÿ', '×‘×ª ×™×', '×‘×ª-×™×', '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', '×¨×—×•×‘×•×ª', '×™×‘× ×”',
    '××©×“×•×“', '××©×§×œ×•×Ÿ', '×’×“×¨×”', '× ×¡ ×¦×™×•× ×”', '× ×¡-×¦×™×•× ×”', '××–×›×¨×ª ×‘×ª×™×”',
    '×©×•×”×', '××œ×¢×“', '×™×”×•×“-××•× ×•×¡×•×Ÿ', '×§×¨×™×™×ª ××•× ×•', '×§×¨×™×™×ª-××•× ×•',
    
    # ×™×™×©×•×‘×™× ×‘×™×”×•×“×” ×•×©×•××¨×•×Ÿ
    '××¨×™××œ', '××¢×œ×” ××“×•××™×', '××¢×œ×”-××“×•××™×', '×‘×™×ª ××œ', '×‘×™×ª-××œ', '×¢×¤×¨×”',
    '×§×“×•××™×', '×¢×× ×•××œ', '××œ×¤×™ ×× ×©×”', '×§×¨×™×™×ª ××¨×‘×¢', '×‘×™×ª×¨ ×¢×™×œ×™×ª',
    '×›×•×›×‘ ×™×¢×§×‘', '×›×•×›×‘-×™×¢×§×‘', '×’×‘×¢×•×Ÿ ×”×—×“×©×”', '×’×‘×¢×•×Ÿ-×”×—×“×©×”', '×©×™×œ×”',
    '××™×ª××¨', '×—×¨××©', '×™×¦×”×¨', '×§×¨× ×™ ×©×•××¨×•×Ÿ', '×§×¨× ×™-×©×•××¨×•×Ÿ', '××œ×•×Ÿ ××•×¨×”',
    '××œ×•×Ÿ-××•×¨×”', '×—×¨×©×”', '×¨×‘×‘×”', '×‘×¨×§×Ÿ', '××¢×œ×” ×œ×‘×•× ×”', '××¢×œ×”-×œ×‘×•× ×”',
    '×˜×œ××•×Ÿ', '×“×•×œ×‘', '×›×•×›×‘ ×”×©×—×¨', '×›×•×›×‘-×”×©×—×¨', '×¨×™××•× ×™×', '××¢×œ×” ×¢××•×¡',
    '××¢×œ×”-×¢××•×¡', '×ª×§×•×¢', '× ×•×§×“×™×', '×›×¤×¨ ××“×•××™×', '×›×¤×¨-××“×•××™×', '×¢×œ××•×Ÿ',
    '×¢× ×ª×•×ª',
    
    # ×™×©×•×‘×™× × ×•×¡×¤×™× ×¨×‘×™× - ××•×©×‘×™× ×•×§×™×‘×•×¦×™×
    '×’×‘×¢×ª ×‘×¨× ×¨', '×’×‘×¢×ª-×‘×¨× ×¨', '×’×‘×¢×ª ×—×™×™×', '×’×‘×¢×ª-×—×™×™×', '×’×‘×¢×ª ×”×©×œ×•×©×”',
    '×’×‘×¢×ª-×”×©×œ×•×©×”', '×’×‘×¢×ª ×©×¤×™×¨×', '×’×‘×¢×ª-×©×¤×™×¨×', '×’×‘×ª', '×’×“×™×©', '×’×“×¢×•× ×”',
    '×’×•× ×Ÿ', '×’×•×¨×Ÿ', '×’×–×™×ª', '×’×™×œ×ª', '×’×œ×™×œ ×™×', '×’×œ×™×œ-×™×', '×’××–×•',
    '×’×Ÿ ×©××•××œ', '×’×Ÿ-×©××•××œ', '×’× ×•×ª', '×’× ×™ ×”×“×¨', '×’× ×™-×”×“×¨', '×’× ×™ ×˜×œ',
    '×’× ×™-×˜×œ', '×’× ×™ ×™×•×—× ×Ÿ', '×’× ×™-×™×•×—× ×Ÿ', '×’×¢×©', '×’×©×¨', '×’×©×¨ ×”×–×™×•',
    '×’×©×¨-×”×–×™×•', '×’×ª', '×’×ª ×¨×™××•×Ÿ', '×’×ª-×¨×™××•×Ÿ', '×“×‘×™×¨×”', '×“×•×¨×•×ª', '×“×™×©×•×Ÿ',
    '×“×œ×™×”', '×“×Ÿ', '×“×¤× ×”', '×”××•×Ÿ', '×”×‘×•× ×™×', '×”×’×•×©×¨×™×', '×”×“×¨ ×¢×', '×”×“×¨-×¢×',
    '×”×–×•×¨×¢×™×', '×”×—×•×ª×¨×™×', '×”×™×•×’×‘', '×”××¢×¤×™×œ', '×”×¢×•×’×Ÿ', '×”×¡×•×œ×œ×™×', '×”×¢××§',
    '×”×¨×“×•×£', '×–×›×¨×™×”', '×–××¨', '×–× ×•×—', '×–×¨×•×¢×”', '×–×¨×™×§×™×”', '×—×“×™×“', '×—×•×œ×“×”',
    '×—×•×œ×ª×”', '×—×•×¡×Ÿ', '×—×•×¤×™×ª', '×—×•×§×•×§', '×—×•×¨×©×™×', '×—×–×•×Ÿ', '×—×™×‘×ª ×¦×™×•×Ÿ',
    '×—×™×‘×ª-×¦×™×•×Ÿ', '×—×™× × ×™×ª', '×—×œ××™×©', '×—××“', '×—××“×™×”', '×—× ×™××œ', '×—× ×™×ª×”',
    '×—×¤×¥ ×—×™×™×', '×—×¤×¥-×—×™×™×', '×—×¦×‘', '×—×¨×•×¦×™×', '×—×¨×•×ª', '×˜×œ ×©×—×¨', '×˜×œ-×©×—×¨',
    '×˜×œ×œ×™×', '×˜×™×¨×ª ×¦×‘×™', '×˜×™×¨×ª-×¦×‘×™', '×˜×™×¨×ª ×™×”×•×“×”', '×˜×™×¨×ª-×™×”×•×“×”',
    '×˜×™×¨×ª ×©×œ×•×', '×˜×™×¨×ª-×©×œ×•×',
    
    # ×™×©×•×‘×™× × ×•×¡×¤×™× - ×¢×¨×™× ×•×¢×™×™×¨×•×ª
    '××‘×™××œ', '××‘×™×‘×™×', '××‘×™×’×“×•×¨', '××‘×™×—×™×œ', '××‘×™×˜×œ', '××‘×™×¢×–×¨', '××‘×™×¨×™×',
    '××‘×Ÿ ×¡×¤×™×¨', '××‘×Ÿ-×¡×¤×™×¨', '××‘×Ÿ ×©××•××œ', '××‘×Ÿ-×©××•××œ', '××‘× ×™ ××™×ª×Ÿ',
    '××‘× ×™-××™×ª×Ÿ', '××‘× ×™ ×—×¤×¥', '××‘× ×™-×—×¤×¥', '××‘× ×ª', '××‘×©×œ×•×', '××“×•×¨×”',
    '××“××™×ª', '××•×“×™×', '××•×“×', '××•×”×“', '××•××Ÿ', '××•××¥', '××•×¤×§', '××•×¨ ×”× ×¨',
    '××•×¨-×”× ×¨', '××•×¨×”', '××•×¨×•×ª', '××•×¨×˜×œ', '××•×¨×Ÿ', '××•×©×”', '××—×•×–×ª ×‘×¨×§',
    '××—×•×–×ª-×‘×¨×§', '××—×™×”×•×“', '××—×™×˜×•×‘', '××—×™×¡××š', '××—×™×¢×–×¨', '××˜×¨×©', '××™×‘×™×',
    '××™×™×œ', '××™×™×œ×ª ×”×©×—×¨', '××™×™×œ×ª-×”×©×—×¨', '××™×œ×•×Ÿ', '××™×œ×•×ª', '××™×œ× ×™×”',
    '××™×¨×•×¡', '××™×ª×Ÿ', '××™×ª× ×™×', '××œ ×¢×–×™', '××œ-×¢×–×™', '××œ ×¢×¨×™××Ÿ', '××œ-×¢×¨×™××Ÿ',
    '××œ×•××”', '××œ×•××•×ª', '××œ×•×Ÿ ×”×’×œ×™×œ', '××œ×•×Ÿ-×”×’×œ×™×œ', '××œ×•×Ÿ ×©×‘×•×ª',
    '××œ×•×Ÿ-×©×‘×•×ª', '××œ×•× ×™ ××‘×', '××œ×•× ×™-××‘×', '××œ×•× ×™ ×”×‘×©×Ÿ', '××œ×•× ×™-×”×‘×©×Ÿ',
    '××œ×•× ×™×', '××œ×™×¤×œ×˜', '××œ×™×§×™×', '××œ×™×©×™×‘', '××œ×™×©××¢', '××œ××’×•×¨', '××œ××•×’',
    '××œ×¢×–×¨', '×××™×¨×™×', '×× ×™×¢×', '××¡×“', '××¡×¤×¨', '××¢×‘×œ×™×Ÿ', '××¢×¦×', '××¤×™×§',
    '××¤×™×§×™×', '××¤×§', '××¤×¨×ª', '××¨×‘×œ', '××¨×’××Ÿ', '××¨×–', '××¨×¡×•×£', '××©×‘×•×œ',
    '××©×‘×œ', '××©×—×¨', '××©×›×•×œ×•×ª', '××©×œ ×”× ×©×™×', '××©×œ-×”× ×©×™×', '××©×œ×™×', '××©×¨×ª',
    '××ª×’×¨', '×‘××¨ ××•×¨×”', '×‘××¨-××•×¨×”', '×‘××¨ ×’× ×™×', '×‘××¨-×’× ×™×', '×‘××¨ ×˜×•×‘×™×”',
    '×‘××¨-×˜×•×‘×™×”', '×‘××¨ ×™×¢×§×‘', '×‘××¨-×™×¢×§×‘', '×‘××¨ ××™×œ×›×”', '×‘××¨-××™×œ×›×”',
    '×‘××¨×•×ª ×™×¦×—×§', '×‘××¨×•×ª-×™×¦×—×§', '×‘××¨×•×ª×™×™×', '×‘××¨×™', '×‘×•×¡×ª×Ÿ ×”×’×œ×™×œ',
    '×‘×•×¡×ª×Ÿ-×”×’×œ×™×œ', '×‘×•×¢×™×™× ×”', '×‘×•×§×¢××ª×', '×‘×•×¨×’×ª×”', '×‘×—×Ÿ', '×‘×˜×—×”',
    '×‘×™×¦×¨×•×Ÿ', '×‘×™×¨×™×”', '×‘×™×ª ××•×¨×Ÿ', '×‘×™×ª-××•×¨×Ÿ', '×‘×™×ª ××œ×¢×–×¨×™', '×‘×™×ª-××œ×¢×–×¨×™',
    '×‘×™×ª ×‘×¨×œ', '×‘×™×ª-×‘×¨×œ', '×‘×™×ª ×’×•×‘×¨×™×Ÿ', '×‘×™×ª-×’×•×‘×¨×™×Ÿ', '×‘×™×ª ×’××œ×™××œ',
    '×‘×™×ª-×’××œ×™××œ', '×‘×™×ª ×”×œ×•×™', '×‘×™×ª-×”×œ×•×™', '×‘×™×ª ×”×œ×œ', '×‘×™×ª-×”×œ×œ',
    '×‘×™×ª ×”×¢××§', '×‘×™×ª-×”×¢××§', '×‘×™×ª ×”×¢×¨×‘×”', '×‘×™×ª-×”×¢×¨×‘×”', '×‘×™×ª ×–×™×“',
    '×‘×™×ª-×–×™×“', '×‘×™×ª ×–×™×ª', '×‘×™×ª-×–×™×ª', '×‘×™×ª ×—×™×¨×•×ª', '×‘×™×ª-×—×™×¨×•×ª',
    '×‘×™×ª ×—×•×¨×•×Ÿ', '×‘×™×ª-×—×•×¨×•×Ÿ', '×‘×™×ª ×—× ×Ÿ', '×‘×™×ª-×—× ×Ÿ', '×‘×™×ª ×—× × ×™×”',
    '×‘×™×ª-×—× × ×™×”', '×‘×™×ª ×—×©××•× ××™', '×‘×™×ª-×—×©××•× ××™', '×‘×™×ª ×™×•×¡×£', '×‘×™×ª-×™×•×¡×£',
    '×‘×™×ª ×™× ××™', '×‘×™×ª-×™× ××™', '×‘×™×ª ×™×¦×—×§', '×‘×™×ª-×™×¦×—×§', '×‘×™×ª ×œ×—× ×”×’×œ×™×œ×™×ª',
    '×‘×™×ª-×œ×—×-×”×’×œ×™×œ×™×ª', '×‘×™×ª ×××™×¨', '×‘×™×ª-×××™×¨', '×‘×™×ª × ×—××™×”', '×‘×™×ª-× ×—××™×”',
    '×‘×™×ª × ×§×•×¤×”', '×‘×™×ª-× ×§×•×¤×”', '×‘×™×ª ×¢×•×–×™××œ', '×‘×™×ª-×¢×•×–×™××œ', '×‘×™×ª ×¢×¨×™×£',
    '×‘×™×ª-×¢×¨×™×£', '×‘×™×ª ×¨×‘×Ÿ', '×‘×™×ª-×¨×‘×Ÿ', '×‘×™×ª ×¨××•', '×‘×™×ª-×¨××•', '×‘×™×ª ×©×§××”',
    '×‘×™×ª-×©×§××”', '×‘×™×ª×Ÿ ××”×¨×Ÿ', '×‘×™×ª×Ÿ-××”×¨×Ÿ', '×‘×œ×¤×•×¨×™×”', '×‘×Ÿ ×–×›××™', '×‘×Ÿ-×–×›××™',
    '×‘×Ÿ ×©××Ÿ', '×‘×Ÿ-×©××Ÿ', '×‘× ×™ ×“×§×œ×™×', '×‘× ×™-×“×§×œ×™×', '×‘× ×™ ×“×¨×•×¨', '×‘× ×™-×“×¨×•×¨',
    '×‘× ×™ ×¢×™"×©', '×‘× ×™-×¢×™"×©', '×‘× ×™ ×¢×˜×¨×•×ª', '×‘× ×™-×¢×˜×¨×•×ª', '×‘× ×™ ×¨××', '×‘× ×™-×¨××',
    '×‘× ×™××™× ×”', '×‘× ×™××™× ×”-×’×‘×¢×ª ×¢×“×”', '×‘× ×™××™× ×”-×’×‘×¢×ª-×¢×“×”', '×‘×¡×"×”',
    '×‘×¡××ª ×˜×‘×¢×•×Ÿ', '×‘×¡××ª-×˜×‘×¢×•×Ÿ', '×‘×ª ×—×Ÿ', '×‘×ª-×—×Ÿ', '×‘×ª ×—×¤×¨', '×‘×ª-×—×¤×¨',
    '×‘×ª ×¢×™×Ÿ', '×‘×ª-×¢×™×Ÿ', '×‘×ª ×©×œ××”', '×‘×ª-×©×œ××”', '×’××•×œ×™ ×ª×™××Ÿ', '×’××•×œ×™-×ª×™××Ÿ',
    '×’××•×œ×™×', '×’××œ×™×”', '×’×‘×™×', '×’×‘×¢', '×’×‘×¢ ×›×¨××œ', '×’×‘×¢-×›×¨××œ',
    '×’×‘×¢ ×‘× ×™××™×Ÿ', '×’×‘×¢-×‘× ×™××™×Ÿ', '×’×‘×¢×•×ª ×‘×¨', '×’×‘×¢×•×ª-×‘×¨', '×’×‘×¢×ª ××‘× ×™',
    '×’×‘×¢×ª-××‘× ×™', '×’×‘×¢×ª ××œ×”', '×’×‘×¢×ª-××œ×”', '×’×‘×¢×ª ×•×•×œ×¤×¡×•×Ÿ', '×’×‘×¢×ª-×•×•×œ×¤×¡×•×Ÿ',
    '×’×‘×¢×ª ×•×•×©×™× ×’×˜×•×Ÿ', '×’×‘×¢×ª-×•×•×©×™× ×’×˜×•×Ÿ', '×’×‘×¢×ª ×—"×Ÿ', '×’×‘×¢×ª-×—"×Ÿ',
    '×’×‘×¢×ª ×›"×—', '×’×‘×¢×ª-×›"×—', '×’×‘×¢×ª × ×™×œ"×™', '×’×‘×¢×ª-× ×™×œ"×™', '×’×‘×¢×ª ×¢×•×–',
    '×’×‘×¢×ª-×¢×•×–', '×’×‘×¢×ª×™', '×’×‘×ª', '×’×“×•×ª', '×’×–×¨', '×’×™××”', '×’×™× ×™×’×¨', '×’×™× ×ª×•×Ÿ',
    '×’×™×ª×”', '×’×™×ª×™×ª', '×’×œ××•×Ÿ', '×’×œ×’×œ', '×’×œ×¢×“', '×’×Ÿ ×”×“×¨×•×', '×’×Ÿ-×”×“×¨×•×',
    '×’×Ÿ ×”×©×•××¨×•×Ÿ', '×’×Ÿ-×”×©×•××¨×•×Ÿ', '×’×Ÿ ×—×™×™×', '×’×Ÿ-×—×™×™×', '×’×Ÿ ×™××©×™×”',
    '×’×Ÿ-×™××©×™×”', '×’×Ÿ ×™×‘× ×”', '×’×Ÿ-×™×‘× ×”', '×’×Ÿ × ×¨', '×’×Ÿ-× ×¨', '×’×Ÿ ×©×œ××”',
    '×’×Ÿ-×©×œ××”', '×’× ×•×ª ×”×“×¨', '×’× ×•×ª-×”×“×¨', '×’× ×™ ××•×“×™×¢×™×Ÿ', '×’× ×™-××•×“×™×¢×™×Ÿ',
    '×’×¤×Ÿ', '×’×¨×•×¤×™×ª', '×’×©×•×¨', '×“×‘×•×¨×”', '×“×‘×•×¨×™×”', '×“×—×™', '×“×™×™×¨ ××œ-××¡×“',
    '×“×™×™×¨-××œ-××¡×“', '×“×™×™×¨ ×—× ×', '×“×™×™×¨-×—× ×', '×“×™×™×¨ ×¨×¤××ª', '×“×™×™×¨-×¨×¤××ª',
    '×“×œ×ª×•×Ÿ', '×“××™×™×“×”', '×“×¨×™×’××ª',
    
    # ×™×©×•×‘×™× × ×•×¡×¤×™× ×‘× ×’×‘ ×”××¢×¨×‘×™
    '××¤×œ×¡×™×', '×ª×œ××™×', '×©×™×‘×•×œ×™×', '××‘×§×™×¢×™×', '×–××¨×ª', '×¢×œ×•××™×', '×—×•×œ×™×ª',
    '××‘×˜×—×™×', '×©×œ×‘×™×', '×‘×™×ª ×§××”', '×‘×™×ª-×§××”',
    }

# ×˜×¢×™× ×ª ×¨×©×™××ª ×”×™×©×•×‘×™×
ISRAELI_SETTLEMENTS = _load_settlements()

# ×”×•×¡×¤×ª ×•×¨×™××¦×™×•×ª ×©×›×ª×•×‘ ×©×œ ×›×œ ×™×©×•×‘
SETTLEMENT_VARIATIONS = {}
for settlement in list(ISRAELI_SETTLEMENTS):
    # ×”×•×¡×¤×” ×œ×œ× ××§×¤×™×
    without_dash = settlement.replace('-', ' ')
    SETTLEMENT_VARIATIONS[without_dash.lower()] = settlement
    SETTLEMENT_VARIATIONS[settlement.lower()] = settlement
    
    # ×”×•×¡×¤×” ×œ×œ× ×¨×•×•×—×™× (×—×™×¤×” -> ×—×™×¤×”, ×ª×œ ××‘×™×‘ -> ×ª×œ××‘×™×‘)
    without_space = settlement.replace(' ', '')
    SETTLEMENT_VARIATIONS[without_space.lower()] = settlement
    
    # ×”×•×¡×¤×” ×¢× ××§×£ ×‘××§×•× ×¨×•×•×— (×ª×œ ××‘×™×‘ -> ×ª×œ-××‘×™×‘)
    with_dash = settlement.replace(' ', '-')
    SETTLEMENT_VARIATIONS[with_dash.lower()] = settlement
    
    # ×”×•×¡×¤×” ×¢× ×¨×•×•×— ×‘××§×•× ××§×£ (×ª×œ-××‘×™×‘ -> ×ª×œ ××‘×™×‘)
    with_space = settlement.replace('-', ' ')
    SETTLEMENT_VARIATIONS[with_space.lower()] = settlement


def similarity(a: str, b: str) -> float:
    """Calculate similarity between two strings (0-1)"""
    return SequenceMatcher(None, a.lower(), b.lower()).ratio()


def validate_settlement(settlement_input: str) -> Tuple[bool, Optional[str], Optional[List[str]]]:
    """
    Validate if settlement exists in Israel
    
    Args:
        settlement_input: The settlement name entered by user
    
    Returns:
        Tuple of (is_valid, exact_match_or_none, list_of_suggestions)
    """
    settlement_input = settlement_input.strip()
    settlement_lower = settlement_input.lower()
    
    # ×—×™×¤×•×© ×”×ª×××” ××“×•×™×§×ª (case insensitive)
    if settlement_lower in SETTLEMENT_VARIATIONS:
        return True, SETTLEMENT_VARIATIONS[settlement_lower], None
    
    # ×—×™×¤×•×© ×”×ª×××” ×—×œ×§×™×ª - ×× ×”×§×œ×˜ ×”×•× ×ª×—×™×œ×ª ×©× ×™×©×•×‘
    # ×œ××©×œ: "×ª×œ ××‘×™×‘" -> "×ª×œ ××‘×™×‘ -×™×¤×•" ××• "×ª×œ ××‘×™×‘-×™×¤×•"
    for settlement in ISRAELI_SETTLEMENTS:
        settlement_lower_check = settlement.lower()
        # ×‘×“×™×§×” ×× ×”×§×œ×˜ ×”×•× ×ª×—×™×œ×ª ×©× ×”×™×©×•×‘ (×¢× ××• ×‘×œ×™ ×¨×•×•×—/××§×£ ××—×¨×™)
        if settlement_lower_check.startswith(settlement_lower):
            # ×‘×“×™×§×” ×©×”×§×œ×˜ ×œ× ×¨×§ ×—×œ×§ ×§×˜×Ÿ ××“×™ (×œ××©×œ "×ª" ×œ× ×™×ª××™× ×œ"×ª×œ ××‘×™×‘")
            if len(settlement_input) >= 3:  # ×œ×¤×—×•×ª 3 ×ª×•×•×™×
                # ×‘×“×™×§×” ×©×”×§×œ×˜ ×”×•× ××™×œ×” ×©×œ××” (×œ× ×—×œ×§ ×××™×œ×”)
                # ×× ×™×© ×¨×•×•×—/××§×£ ××—×¨×™ ×”×§×œ×˜ ×‘×™×©×•×‘, ××• ×©×”×§×œ×˜ ×”×•× ×‘×“×™×•×§ ×ª×—×™×œ×ª ×”×™×©×•×‘
                remaining = settlement_lower_check[len(settlement_lower):].strip()
                # ×× ××™×Ÿ ×©××¨×™×ª, ××• ×©×”×©××¨×™×ª ××ª×—×™×œ×” ×‘×¨×•×•×— ××• ××§×£, ×–×” ×ª×§×™×Ÿ
                if not remaining or remaining.startswith((' ', '-')):
                    return True, settlement, None
    
    # ×× ×œ× × ××¦× ×”×ª×××” ××“×•×™×§×ª, × ×—×¤×© ×”×ª×××•×ª ×“×•××•×ª
    suggestions = []
    for settlement in ISRAELI_SETTLEMENTS:
        sim = similarity(settlement_input, settlement)
        if sim > 0.6:  # ×“××™×•×Ÿ ×©×œ 60% ×•××¢×œ×”
            suggestions.append((settlement, sim))
    
    # ××™×•×Ÿ ×œ×¤×™ ×¨××ª ×“××™×•×Ÿ (×”×’×‘×•×” ×‘×™×•×ª×¨ ×¨××©×•×Ÿ)
    suggestions.sort(key=lambda x: x[1], reverse=True)
    
    # × ×—×–×™×¨ ××ª 3 ×”×”×¦×¢×•×ª ×”×˜×•×‘×•×ª ×‘×™×•×ª×¨
    top_suggestions = [s[0] for s in suggestions[:3]]
    
    if top_suggestions:
        return False, None, top_suggestions
    
    # ×× ××™×Ÿ ×”×¦×¢×•×ª ×˜×•×‘×•×ª, × ×—×–×™×¨ False ×œ×œ× ×”×¦×¢×•×ª
    return False, None, None


def validate_days(days_input: str) -> Tuple[bool, Optional[str], Optional[str]]:
    """
    Validate day format input
    
    Args:
        days_input: Days input from user (e.g., "×-×”", "×,×’,×”", "×›×œ ×™×•×")
    
    Returns:
        Tuple of (is_valid, normalized_format or None, error_message or None)
    """
    days_input = days_input.strip()
    
    # ×“×¤×•×¡×™× ×ª×§×™× ×™×
    valid_patterns = [
        r'^[×-×•]{1}-[×-×•]{1}$',  # ×-×”, ×-×•
        r'^[×-×•]{1},[×-×•]{1}(,[×-×•]{1})*$',  # ×,×’,×”
        r'^×›×œ ×™×•×$',
        r'^×›×œ ×”×™××™×$',
        r'^×™×•××™$',
        r'^(×¨××©×•×Ÿ|×©× ×™|×©×œ×™×©×™|×¨×‘×™×¢×™|×—××™×©×™|×©×™×©×™|×©×‘×ª)( ×•)?(×¨××©×•×Ÿ|×©× ×™|×©×œ×™×©×™|×¨×‘×™×¢×™|×—××™×©×™|×©×™×©×™|×©×‘×ª)?$',
        r'^(Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday)',
    ]
    
    # ×‘×“×™×§×” ×× ×”×ª×‘× ×™×ª ×ª×§×™× ×”
    for pattern in valid_patterns:
        if re.match(pattern, days_input, re.IGNORECASE):
            return True, days_input, None
    
    # ×‘×“×™×§×” ×× ×™×© ×¨×•×•×—×™× ××™×•×ª×¨×™×
    days_no_spaces = days_input.replace(' ', '')
    for pattern in valid_patterns:
        if re.match(pattern, days_no_spaces):
            return True, days_no_spaces, None
    
    # ×× ×œ× ×ª×§×™×Ÿ, × ×—×–×™×¨ ×”×•×“×¢×ª ×©×’×™××”
    error_message = """
×¤×•×¨××˜ ×œ× ×ª×§×™×Ÿ! ğŸ˜…

×“×•×’×××•×ª × ×›×•× ×•×ª:
â€¢ ×-×” (×¨××©×•×Ÿ ×¢×“ ×—××™×©×™)
â€¢ ×,×’,×” (×™××™× ×¡×¤×¦×™×¤×™×™×)
â€¢ ×›×œ ×™×•×
â€¢ ×¨××©×•×Ÿ ×•×©×œ×™×©×™

× ×¡×” ×©×•×‘! ğŸ˜Š
""".strip()
    
    return False, None, error_message


def validate_time(time_input: str) -> Tuple[bool, Optional[str], Optional[str]]:
    """
    Validate time format input
    
    Args:
        time_input: Time input from user (e.g., "08:00", "14:30", "7:0", "6")
    
    Returns:
        Tuple of (is_valid, normalized_format or None, error_message or None)
    """
    time_input = time_input.strip()
    
    # First check if it's just a single digit or two digits (hours only)
    # e.g., "6" â†’ "06:00", "14" â†’ "14:00"
    single_hour_pattern = r'^([0-9]{1,2})$'
    match = re.match(single_hour_pattern, time_input)
    if match:
        hours = int(match.group(1))
        if 0 <= hours <= 23:
            # Normalize: add :00 minutes
            normalized = f"{hours:02d}:00"
            return True, normalized, None
        else:
            error_message = "×©×¢×•×ª ×—×™×™×‘×•×ª ×œ×”×™×•×ª ×‘×™×Ÿ 0 ×œ-23! ğŸ˜…"
            return False, None, error_message
    
    # ×“×¤×•×¡×™× ×ª×§×™× ×™× - ×™×•×ª×¨ ×’××™×©: H:MM, HH:MM, H:M, HH:M
    time_pattern = r'^([0-9]{1,2}):([0-9]{1,2})$'
    
    match = re.match(time_pattern, time_input)
    if match:
        hours = int(match.group(1))
        minutes = int(match.group(2))
        
        # Normalize minutes to 2 digits
        if minutes > 59:
            error_message = "×“×§×•×ª ×œ× ×™×›×•×œ×•×ª ×œ×”×™×•×ª ×™×•×ª×¨ ×-59! ğŸ˜…"
            return False, None, error_message
        
        if 0 <= hours <= 23:
            # × ×¨××•×œ - ×”×•×¡×¤×ª 0 ×‘×”×ª×—×œ×” ×× ×¦×¨×™×š
            normalized = f"{hours:02d}:{minutes:02d}"
            return True, normalized, None
        else:
            error_message = "×©×¢×•×ª ×—×™×™×‘×•×ª ×œ×”×™×•×ª ×‘×™×Ÿ 0 ×œ-23! ğŸ˜…"
            return False, None, error_message
    
    error_message = """
×¤×•×¨××˜ ×©×¢×” ×œ× ×ª×§×™×Ÿ! â°

×“×•×’×××•×ª × ×›×•× ×•×ª:
â€¢ 08:00
â€¢ 14:30
â€¢ 7:00 (×–×” ×’× ×‘×¡×“×¨!)
â€¢ 7:0 (×–×” ×’× ×™×¢×‘×•×“!)
â€¢ 6 (×–×” ×’× ×™×¢×‘×•×“! ×™×ª×¤×¨×© ×›-06:00)

× ×¡×” ×©×•×‘! ğŸ˜Š
""".strip()
    
    return False, None, error_message


def validate_time_range(time_range_input: str) -> Tuple[bool, Optional[str], Optional[str]]:
    """
    Validate time range format input
    
    Supports multiple formats:
    - "7-9" â†’ "07:00-09:00"
    - "7:00-9:00" â†’ "07:00-09:00"
    - "08:00-10:00" â†’ "08:00-10:00"
    - "7:30-9:30" â†’ "07:30-09:30"
    
    Args:
        time_range_input: Time range input from user
    
    Returns:
        Tuple of (is_valid, normalized_format or None, error_message or None)
    """
    time_range_input = time_range_input.strip()
    
    # Pattern 1: Simple format "7-9" or "07-09" (hours only, assumes :00 minutes)
    simple_pattern = r'^([0-9]{1,2})\s*-\s*([0-9]{1,2})$'
    match = re.match(simple_pattern, time_range_input)
    if match:
        start_hours = int(match.group(1))
        end_hours = int(match.group(2))
        
        if 0 <= start_hours <= 23 and 0 <= end_hours <= 23:
            if end_hours > start_hours:
                # Normalize: add :00 minutes
                normalized = f"{start_hours:02d}:00-{end_hours:02d}:00"
                return True, normalized, None
            else:
                error_message = "×©×¢×ª ×”×¡×™×•× ×¦×¨×™×›×” ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”! ğŸ˜…"
                return False, None, error_message
    
    # Pattern 2: Full format "HH:MM-HH:MM" or "H:MM-H:MM" (with optional spaces around dash)
    time_range_pattern = r'^([0-9]{1,2}):([0-9]{1,2})\s*-\s*([0-9]{1,2}):([0-9]{1,2})$'
    match = re.match(time_range_pattern, time_range_input)
    if match:
        start_hours = int(match.group(1))
        start_minutes = int(match.group(2))
        end_hours = int(match.group(3))
        end_minutes = int(match.group(4))
        
        # ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×©×¢×•×ª ×•×“×§×•×ª
        if (0 <= start_hours <= 23 and 0 <= start_minutes <= 59 and
            0 <= end_hours <= 23 and 0 <= end_minutes <= 59):
            
            # ×‘×“×™×§×” ×©×©×¢×ª ×”×¡×™×•× ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”
            start_total = start_hours * 60 + start_minutes
            end_total = end_hours * 60 + end_minutes
            
            if end_total > start_total:
                # × ×¨××•×œ
                normalized = f"{start_hours:02d}:{start_minutes:02d}-{end_hours:02d}:{end_minutes:02d}"
                return True, normalized, None
            else:
                error_message = "×©×¢×ª ×”×¡×™×•× ×¦×¨×™×›×” ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”! ğŸ˜…"
                return False, None, error_message
    
    error_message = """
×¤×•×¨××˜ ×˜×•×•×— ×©×¢×•×ª ×œ× ×ª×§×™×Ÿ! â°

×“×•×’×××•×ª × ×›×•× ×•×ª:
â€¢ 7-9 (×¤×©×•×˜ ×©×¢×•×ª - ×”×›×™ ×§×œ! ğŸ˜Š)
â€¢ 08:00-10:00 (×¤×•×¨××˜ ××œ×)
â€¢ 7:00-9:00 (×’× ×‘×¡×“×¨!)
â€¢ 14:30-17:00 (×¢× ×“×§×•×ª)

× ×¡×” ×©×•×‘! ğŸ˜Š
""".strip()
    
    return False, None, error_message


def validate_name(name_input: str) -> Tuple[bool, Optional[str], Optional[str]]:
    """
    Validate name input
    
    Args:
        name_input: Name input from user
    
    Returns:
        Tuple of (is_valid, normalized_name or None, error_message or None)
    """
    name_input = name_input.strip()
    
    # Check if empty or whitespace only
    if not name_input or len(name_input) == 0:
        error_message = "×©× ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×¨×™×§. ×× × ×”×›× ×¡ ×©× ×ª×§×™×Ÿ."
        return False, None, error_message
    
    # Check minimum length (at least 2 characters)
    if len(name_input) < 2:
        error_message = "×©× ×—×™×™×‘ ×œ×”×›×™×œ ×œ×¤×—×•×ª 2 ×ª×•×•×™×."
        return False, None, error_message
    
    # Check if it's only numbers
    if name_input.isdigit():
        error_message = "×©× ×œ× ×™×›×•×œ ×œ×”×›×™×œ ×¨×§ ××¡×¤×¨×™×. ×× × ×”×›× ×¡ ×©× ×ª×§×™×Ÿ."
        return False, None, error_message
    
    # Check if it's only special characters (no letters/numbers)
    if not re.search(r'[×-×ªa-zA-Z0-9]', name_input):
        error_message = "×©× ×—×™×™×‘ ×œ×”×›×™×œ ××•×ª×™×•×ª. ×× × ×”×›× ×¡ ×©× ×ª×§×™×Ÿ."
        return False, None, error_message
    
    # Check maximum length (reasonable limit)
    if len(name_input) > 100:
        error_message = "×©× ××¨×•×š ××“×™. ×× × ×”×›× ×¡ ×©× ×§×¦×¨ ×™×•×ª×¨ (×¢×“ 100 ×ª×•×•×™×)."
        return False, None, error_message
    
    # Normalize: remove extra spaces
    normalized = ' '.join(name_input.split())
    
    return True, normalized, None


def validate_text_input(text_input: str, min_length: int = 1, max_length: int = 1000) -> Tuple[bool, Optional[str], Optional[str]]:
    """
    Generic text input validation
    
    Args:
        text_input: Text input from user
        min_length: Minimum length required
        max_length: Maximum length allowed
    
    Returns:
        Tuple of (is_valid, normalized_text or None, error_message or None)
    """
    text_input = text_input.strip()
    
    # Check if empty
    if not text_input or len(text_input) == 0:
        error_message = f"×§×œ×˜ ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×¨×™×§. ×× × ×”×›× ×¡ ×œ×¤×—×•×ª {min_length} ×ª×•."
        return False, None, error_message
    
    # Check minimum length
    if len(text_input) < min_length:
        error_message = f"×§×œ×˜ ×§×¦×¨ ××“×™. ×× × ×”×›× ×¡ ×œ×¤×—×•×ª {min_length} ×ª×•×•×™×."
        return False, None, error_message
    
    # Check maximum length
    if len(text_input) > max_length:
        error_message = f"×§×œ×˜ ××¨×•×š ××“×™. ×× × ×”×›× ×¡ ×¢×“ {max_length} ×ª×•×•×™×."
        return False, None, error_message
    
    # Normalize: remove extra spaces
    normalized = ' '.join(text_input.split())
    
    return True, normalized, None

