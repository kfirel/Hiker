# 📝 Changelog - Hiker Admin Dashboard

## [2.1.0] - 2026-01-03

### ✨ תכונות חדשות

#### 1. היסטוריית צ'אט מורחבת
- **הגדלת היסטוריה**: שינוי `MAX_CHAT_HISTORY` מ-20 ל-100 הודעות
- **Modal חדש**: `UserDetailsModal.jsx` - הצגת פרטי משתמש והיסטוריית צ'אט מלאה
- **2 טאבים**:
  - היסטוריית צ'אט - כל ההודעות (עד 100 אחרונות)
  - פרטים - מידע כללי על המשתמש
- **UX**: לחיצה על שורה בטבלת המשתמשים פותחת את ה-Modal

#### 2. תצוגת מסלול נסיעה
- **Modal חדש**: `RideMapModal.jsx` - הצגת מידע על מסלול נסיעה
- **מידע מוצג**:
  - פרטי הנסיעה המלאים (נהג/טרמפיסט, טלפון, זמנים)
  - מרחק המסלול בק"מ
  - טווח התאמה (threshold) בק"מ
  - קישור ל-Google Maps
- **UX**: לחיצה על נסיעה בטבלה פותחת את ה-Modal

#### 3. מחיקת משתמש
- **כפתור מחיקה**: הוספת עמודה "פעולות" עם כפתור 🗑️
- **אישור**: חלון אישור לפני מחיקה (למניעת טעויות)
- **API**: שימוש ב-endpoint קיים `DELETE /a/users/{phone_number}`
- **Mutation**: שימוש ב-React Query למחיקה ועדכון אוטומטי של הטבלה

#### 4. נהגים וטרמפיסטים באותו מסך
- **הסרת טאבים**: הוסרה הצורך לעבור בין טאבים
- **2 טבלאות נפרדות**:
  - נהגים פעילים (רקע כחול)
  - טרמפיסטים פעילים (רקע ירוק)
- **ייצוא נפרד**: כל טבלה עם כפתור ייצוא משלה
- **UX משופר**: גלילה חלקה בין הטבלאות

---

### 🔧 שינויים טכניים

#### Backend:
- `config.py`: שינוי `MAX_CHAT_HISTORY = 100`

#### Frontend - קבצים חדשים:
- `frontend/src/components/Users/UserDetailsModal.jsx`
- `frontend/src/components/Rides/RideMapModal.jsx`

#### Frontend - קבצים ששונו:
- `frontend/src/pages/UsersPage.jsx`:
  - הוספת `UserDetailsModal`
  - הוספת `deleteMutation` עם React Query
  - הוספת `handleDeleteUser`
  - הוספת עמודה "פעולות" לטבלה
  - הוספת `onClick` לשורות הטבלה
- `frontend/src/pages/RidesPage.jsx`:
  - הסרת `activeTab` state
  - הסרת טאבים מה-UI
  - פיצול ל-2 טבלאות נפרדות
  - הוספת `RideMapModal`
  - הוספת `handleExportDrivers` ו-`handleExportHitchhikers`
  - הוספת `onClick` לשורות הטבלה
- `frontend/package.json`:
  - הוספת `leaflet: ^1.9.4`
  - הוספת `react-leaflet: ^4.2.1`

#### תיעוד:
- `ADMIN_FEATURES_UPDATE.md` - תיעוד מפורט של התכונות החדשות
- `UPDATE_GUIDE.md` - מדריך עדכון צעד-אחר-צעד
- `FEATURES_SUMMARY.md` - סיכום גרפי של הפיצ'רים
- `CHANGELOG.md` - קובץ זה

---

### 🎨 שיפורי UI/UX

#### עיצוב:
- **Modals**: שימוש ב-Modals במקום ניווט לעמודים חדשים
- **Hover effects**: אפקטים ברורים על שורות שניתן ללחוץ עליהן
- **צבעים**: כחול לנהגים, ירוק לטרמפיסטים
- **אייקונים**: שימוש באמוג'י לבהירות (🗑️, 🗺️, 💬, 🚗, 🎒)

#### נגישות:
- **ESC key**: סגירת Modals עם מקש ESC
- **Click outside**: סגירת Modals בלחיצה מחוץ לחלון
- **אישורים**: אישור לפעולות הרסניות (מחיקה)
- **Loading states**: אינדיקטורים ברורים לטעינה

---

### 🔒 אבטחה

- כל ה-endpoints דורשים `ADMIN_TOKEN`
- מחיקת משתמש דורשת אישור מפורש
- אין שינוי בהרשאות הקיימות

---

### 📊 ביצועים

- **היסטוריית צ'אט**: 100 הודעות במקום 20 (גידול של x5)
  - השפעה על DB: מינימלית (כ-80 הודעות נוספות למשתמש)
  - השפעה על זמן טעינה: זניחה (הודעות קטנות)
- **Modals**: טעינה lazy של נתונים (רק כשנפתחים)
- **React Query**: caching אוטומטי של נתונים

---

### 🐛 תיקוני באגים

- תוקן: בעיית ייצוא CSV כשאין `activeTab`
- תוקן: בעיית סגירת Modal עם ESC
- תוקן: בעיית עדכון טבלה אחרי מחיקה

---

### 📦 תלויות חדשות

```json
{
  "leaflet": "^1.9.4",
  "react-leaflet": "^4.2.1"
}
```

---

### 🚀 איך לעדכן

#### אופציה 1: Google Cloud Console
1. פתח Cloud Build → Triggers
2. הרץ את ה-Trigger
3. המערכת תתעדכן אוטומטית

#### אופציה 2: Cloud Shell
```bash
gcloud builds submit --tag gcr.io/[PROJECT_ID]/hiker
gcloud run deploy hiker --image gcr.io/[PROJECT_ID]/hiker ...
```

#### אופציה 3: מקומית (אם יש npm)
```bash
cd frontend && npm install && npm run build
cd .. && python3 main.py
```

---

### ✅ בדיקות שבוצעו

- ✅ Modal משתמש נפתח ומציג היסטוריה
- ✅ Modal נסיעה נפתח ומציג מידע
- ✅ מחיקת משתמש עובדת ומעדכנת את הטבלה
- ✅ 2 הטבלאות מוצגות יחד
- ✅ ייצוא CSV עובד לכל טבלה בנפרד
- ✅ לחיצה על שורה פותחת Modal
- ✅ ESC סוגר את ה-Modal
- ✅ אישור מחיקה מופיע

---

### 📝 הערות

#### למפתחים:
- כל ה-API endpoints היו קיימים מראש
- השינויים הם בעיקר ב-Frontend
- אין breaking changes

#### למשתמשים:
- כל התכונות הקיימות ממשיכות לעבוד
- התכונות החדשות הן תוספות בלבד
- אין צורך בהגדרות נוספות

---

### 🔮 תכונות עתידיות (לא במהדורה זו)

- 🗺️ מפה אינטראקטיבית עם Leaflet (במקום קישור ל-Google Maps)
- 📊 גרפים של היסטוריית משתמש
- 🔔 התראות על פעילות חשודה
- 📱 תמיכה במובייל משופרת
- 🌐 תרגום לשפות נוספות

---

## [2.0.0] - 2025-12-XX

### ✨ גרסה ראשונה של ממשק הניהול
- Dashboard עם סטטיסטיקות
- ניהול משתמשים
- ניהול נסיעות
- לוגים ושגיאות
- ייצוא CSV

---

**תאריך**: 3 ינואר 2026  
**גרסה**: 2.1.0  
**מפתח**: צוות Hiker

