# Integration Test Scenarios for Hiker WhatsApp Bot
# These tests check data persistence, matching, and notifications
# Each scenario involves multiple users interacting with the system

scenarios:
  # Scenario 1: Driver creates routine, hitchhiker requests ride, matching occurs
  - id: 1
    name: "Complete Matching Flow - Morning Routine"
    description: "Driver sets morning routine to Tel Aviv, hitchhiker requests ride to same destination at same time, matching occurs"
    users:
      - user_id: "driver_001"
        phone: "0501111111"
        type: "driver"
        setup_messages:
          - "היי"
          - "יוסי נהג"
          - "חיפה"
          - "3"  # Driver
          - "1"  # Has routine
          - "תל אביב"
          - "א-ה"  # Sunday-Friday
          - "07:00"  # Departure time
          - "18:00"  # Return time
          - "2"  # No more destinations
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0  # No wait after setup
        
      - user_id: "hitchhiker_001"
        phone: "0502222222"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "דני טרמפיסט"
          - "תל אביב"
          - "2"  # Hitchhiker
          - "2"  # Not looking now
          - "2"  # No default destination
        wait_after: 0
        
      - user_id: "hitchhiker_001"
        phone: "0502222222"
        type: "hitchhiker"
        action_messages:
          - "שלום"  # Trigger menu (will show registered_user_menu)
          - "1"  # Looking for ride (will go to ask_hitchhiker_when_need_ride)
          - "1"  # Now (ממש עכשיו) - selects timing option 1
          - "תל אביב"  # Destination - this completes the request
        wait_after: 0
        
      - user_id: "driver_001"
        phone: "0501111111"
        type: "driver"
        action_messages:
          - "1"  # Approve match (1 = approve)
        wait_after: 0
        
      - user_id: "hitchhiker_001"
        phone: "0502222222"
        type: "hitchhiker"
        action_messages:
          # After driver approves, hitchhiker should receive notification
          # This step verifies the notification was received
          - "שלום"  # Just checking the menu - notification should already be in logs
        wait_after: 0

  # Scenario 2: Same scenario but in afternoon
  - id: 2
    name: "Complete Matching Flow - Afternoon Routine"
    description: "Driver sets afternoon routine, hitchhiker requests ride at different time, still matches"
    users:
      - user_id: "driver_002"
        phone: "0503333333"
        type: "driver"
        setup_messages:
          - "היי"
          - "רותי נהגת"
          - "ירושלים"
          - "3"  # Driver
          - "1"  # Has routine
          - "תל אביב"
          - "ב,ד"  # Tuesday, Thursday
          - "14:00"  # Afternoon departure
          - "20:00"  # Evening return
          - "2"  # No more destinations
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_002"
        phone: "0504444444"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "מיכל טרמפיסטית"
          - "רמת גן"
          - "2"  # Hitchhiker
          - "2"  # Not looking now
          - "2"  # No default destination
        wait_after: 0
        
      - user_id: "hitchhiker_002"
        phone: "0504444444"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now (ממש עכשיו)
          - "תל אביב"  # Same destination - this completes the request
        wait_after: 0
        
      - user_id: "driver_002"
        phone: "0503333333"
        type: "driver"
        action_messages:
          - "1"  # Approve match (1 = approve)
        wait_after: 0
        
      - user_id: "hitchhiker_002"
        phone: "0504444444"
        type: "hitchhiker"
        action_messages:
          # After driver approves, hitchhiker should receive notification
          - "שלום"  # Just checking the menu - notification should already be in logs
        wait_after: 0

  # Scenario 3: Multiple drivers, one hitchhiker - test matching algorithm
  - id: 3
    name: "Multiple Drivers Matching"
    description: "Two drivers with same destination, hitchhiker requests ride, both get matched"
    users:
      - user_id: "driver_003a"
        phone: "0505555555"
        type: "driver"
        setup_messages:
          - "היי"
          - "אבי נהג"
          - "חיפה"
          - "3"
          - "1"
          - "ירושלים"
          - "א-ה"
          - "08:00"
          - "17:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "driver_003b"
        phone: "0506666666"
        type: "driver"
        setup_messages:
          - "שלום"
          - "דוד נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "ירושלים"  # Same destination
          - "א-ה"
          - "08:30"  # Slightly different time
          - "17:30"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_003"
        phone: "0507777777"
        type: "hitchhiker"
        setup_messages:
          - "היי"
          - "שרה טרמפיסטית"
          - "רעננה"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_003"
        phone: "0507777777"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now (ממש עכשיו)
          - "ירושלים"  # Same destination - this completes the request
        wait_after: 0
        
      - user_id: "driver_003a"
        phone: "0505555555"
        type: "driver"
        action_messages:
          - "1"  # First driver approves (1 = approve)
        wait_after: 0
        
      - user_id: "driver_003b"
        phone: "0506666666"
        type: "driver"
        action_messages:
          - "2"  # Second driver rejects (2 = reject)
        wait_after: 0
        
      - user_id: "hitchhiker_003"
        phone: "0507777777"
        type: "hitchhiker"
        action_messages:
          # After first driver approves, hitchhiker should receive notification
          # Second driver rejection doesn't send notification to hitchhiker
          - "שלום"  # Just checking the menu - notification should already be in logs
        wait_after: 0

  # Scenario 4: Driver rejection flow
  - id: 4
    name: "Driver Rejection Flow"
    description: "Driver rejects match, hitchhiker continues searching"
    users:
      - user_id: "driver_004"
        phone: "0508888888"
        type: "driver"
        setup_messages:
          - "היי"
          - "עמית נהג"
          - "באר שבע"
          - "3"
          - "1"
          - "תל אביב"
          - "א,ג,ה"
          - "09:00"
          - "19:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_004"
        phone: "0509999999"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "יונתן טרמפיסט"
          - "אשדוד"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_004"
        phone: "0509999999"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now (ממש עכשיו)
          - "תל אביב"  # Same destination - this completes the request
        wait_after: 0
        
      - user_id: "driver_004"
        phone: "0508888888"
        type: "driver"
        action_messages:
          - "2"  # Reject match (2 = reject)
        wait_after: 0
        
      - user_id: "hitchhiker_004"
        phone: "0509999999"
        type: "hitchhiker"
        action_messages:
          # After driver rejects, hitchhiker should NOT receive notification
          # (only approvals send notifications)
          - "שלום"  # Just checking the menu
        wait_after: 0

  # Scenario 5: Specific datetime request
  - id: 5
    name: "Specific DateTime Request"
    description: "Hitchhiker requests ride for specific future date/time"
    users:
      - user_id: "driver_005"
        phone: "0511111111"
        type: "driver"
        setup_messages:
          - "היי"
          - "נועה נהגת"
          - "חיפה"
          - "3"
          - "1"
          - "תל אביב"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_005"
        phone: "0512222222"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אור טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_005"
        phone: "0512222222"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now (ממש עכשיו)
          - "תל אביב"  # Same destination - this completes the request
        wait_after: 0
        
      - user_id: "driver_005"
        phone: "0511111111"
        type: "driver"
        action_messages:
          - "1"  # Approve match (1 = approve)
        wait_after: 0
        
      - user_id: "hitchhiker_005"
        phone: "0512222222"
        type: "hitchhiker"
        action_messages:
          # After driver approves, hitchhiker should receive notification
          - "שלום"  # Just checking the menu - notification should already be in logs
        wait_after: 0

  # Scenario 6: Driver offer (not routine)
  - id: 6
    name: "Driver Offer Flow"
    description: "Driver offers one-time ride, hitchhiker requests, matching occurs"
    users:
      - user_id: "driver_006"
        phone: "0513333333"
        type: "driver"
        setup_messages:
          - "היי"
          - "אלון נהג"
          - "תל אביב"
          - "3"
          - "2"  # No routine
          - "4"  # No alerts
        wait_after: 0
        
      - user_id: "driver_006"
        phone: "0513333333"
        type: "driver"
        action_messages:
          - "שלום"
          - "2"  # Offering ride
          - "1"  # Leaving now
          - "ירושלים"
        wait_after: 0
        
      - user_id: "hitchhiker_006"
        phone: "0514444444"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "תמר טרמפיסטית"
          - "רעננה"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_006"
        phone: "0514444444"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now (ממש עכשיו)
          - "ירושלים"  # Same destination - this completes the request
        wait_after: 0
        
      - user_id: "driver_006"
        phone: "0513333333"
        type: "driver"
        action_messages:
          - "1"  # Approve match (1 = approve)
        wait_after: 0

  # Scenario 7: Driver with "ask" preference - should be asked before sharing name
  - id: 7
    name: "Driver Ask Preference Flow"
    description: "Driver with 'ask' preference - should be asked before sharing name with hitchhiker"
    users:
      - user_id: "driver_007"
        phone: "0515555555"
        type: "driver"
        setup_messages:
          - "היי"
          - "ליאור נהג"
          - "3"  # Driver
          - "1"
          - "תל אביב"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference
          - "2"  # Share name preference: ask
        wait_after: 0
        
      - user_id: "hitchhiker_007"
        phone: "0516666666"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "עדי טרמפיסטית"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_007"
        phone: "0516666666"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "תל אביב"
        wait_after: 0
        
      - user_id: "driver_007"
        phone: "0515555555"
        type: "driver"
        action_messages:
          - "1"  # Approve match
          - "share_name_yes_"  # Approve sharing name (will be replaced with actual match_id)
        wait_after: 0
        
      - user_id: "hitchhiker_007"
        phone: "0516666666"
        type: "hitchhiker"
        action_messages:
          - "שלום"  # Check notification received
        wait_after: 0

  # Scenario 8: Driver with "never" preference - should not share name
  - id: 8
    name: "Driver Never Share Name Flow"
    description: "Driver with 'never' preference - hitchhiker should receive only phone number"
    users:
      - user_id: "driver_008"
        phone: "0517777777"
        type: "driver"
        setup_messages:
          - "היי"
          - "רון נהג"
          - "3"  # Driver
          - "1"
          - "ירושלים"
          - "א-ה"
          - "08:00"
          - "17:00"
          - "2"
          - "3"  # Alert preference
          - "2"  # Share name preference: ask (will be set to never in test)
        wait_after: 0
        
      - user_id: "hitchhiker_008"
        phone: "0518888888"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "נועם טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_008"
        phone: "0518888888"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "ירושלים"
        wait_after: 0
        
      - user_id: "driver_008"
        phone: "0517777777"
        type: "driver"
        action_messages:
          - "1"  # Approve match
          - "share_name_no_"  # Reject sharing name (will be replaced with actual match_id)
        wait_after: 0
        
      - user_id: "hitchhiker_008"
        phone: "0518888888"
        type: "hitchhiker"
        action_messages:
          - "שלום"  # Check notification received (should have phone but no name)
        wait_after: 0

  # Scenario 9: No matching drivers - hitchhiker should receive notification that no matches found
  - id: 9
    name: "No Matching Drivers"
    description: "Hitchhiker requests ride to destination with no matching drivers"
    users:
      - user_id: "hitchhiker_009"
        phone: "0519999999"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "יובל טרמפיסט"
          - "2"  # Hitchhiker
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_009"
        phone: "0519999999"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "אילת"  # Destination with no drivers
        wait_after: 0

  # Scenario 10: Driver with multiple destinations
  - id: 10
    name: "Driver Multiple Destinations"
    description: "Driver with multiple routine destinations, hitchhiker requests one of them"
    users:
      - user_id: "driver_010"
        phone: "0521111111"
        type: "driver"
        setup_messages:
          - "היי"
          - "אורית נהגת"
          - "חיפה"
          - "3"
          - "1"
          - "תל אביב"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "1"  # Yes, more destinations
          - "ירושלים"
          - "א,ג"
          - "09:00"
          - "19:00"
          - "2"  # No more destinations
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_010"
        phone: "0522222222"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "דנה טרמפיסטית"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_010"
        phone: "0522222222"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "ירושלים"  # Second destination
        wait_after: 0
        
      - user_id: "driver_010"
        phone: "0521111111"
        type: "driver"
        action_messages:
          - "1"  # Approve match
        wait_after: 0

  # Scenario 11: Hitchhiker with default destination
  - id: 11
    name: "Hitchhiker Default Destination"
    description: "Hitchhiker sets default destination and uses it in request"
    users:
      - user_id: "driver_011"
        phone: "0523333333"
        type: "driver"
        setup_messages:
          - "היי"
          - "איתן נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "חיפה"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_011"
        phone: "0524444444"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "מיכאל טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"  # Not looking now
          - "1"  # Yes, set default destination
          - "חיפה"  # Default destination
        wait_after: 0
        
      - user_id: "hitchhiker_011"
        phone: "0524444444"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "1"  # Use default destination
        wait_after: 0
        
      - user_id: "driver_011"
        phone: "0523333333"
        type: "driver"
        action_messages:
          - "1"  # Approve match
        wait_after: 0

  # Scenario 12: Driver rejects then hitchhiker requests again
  - id: 12
    name: "Rejection Then New Request"
    description: "Driver rejects match, then hitchhiker requests again and gets matched with different driver"
    users:
      - user_id: "driver_012a"
        phone: "0525555555"
        type: "driver"
        setup_messages:
          - "היי"
          - "עומר נהג"
          - "3"  # Driver
          - "1"
          - "חיפה"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "driver_012b"
        phone: "0526666666"
        type: "driver"
        setup_messages:
          - "שלום"
          - "תומר נהג"
          - "3"  # Driver
          - "1"
          - "חיפה"
          - "א-ה"
          - "08:00"
          - "17:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_012"
        phone: "0527777777"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אליה טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_012"
        phone: "0527777777"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "חיפה"
        wait_after: 0
        
      - user_id: "driver_012a"
        phone: "0525555555"
        type: "driver"
        action_messages:
          - "2"  # Reject match
        wait_after: 0
        
      - user_id: "hitchhiker_012"
        phone: "0527777777"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride again
          - "1"  # Now
          - "חיפה"  # Same destination
        wait_after: 0
        
      - user_id: "driver_012b"
        phone: "0526666666"
        type: "driver"
        action_messages:
          - "1"  # Approve match
        wait_after: 0

  # Scenario 13: Driver with different alert preferences
  - id: 13
    name: "Driver Alert Preferences"
    description: "Test different alert preferences - driver should receive notifications based on preference"
    users:
      - user_id: "driver_013a"
        phone: "0528888888"
        type: "driver"
        setup_messages:
          - "היי"
          - "יואב נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "ירושלים"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "1"  # Alert preference: all requests
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "driver_013b"
        phone: "0529999999"
        type: "driver"
        setup_messages:
          - "שלום"
          - "אליאור נהג"
          - "חיפה"
          - "3"
          - "1"
          - "ירושלים"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "2"  # Alert preference: only my destinations
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_013"
        phone: "0531111111"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "עמית טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_013"
        phone: "0531111111"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "ירושלים"
        wait_after: 0
        
      - user_id: "driver_013a"
        phone: "0528888888"
        type: "driver"
        action_messages:
          - "1"  # Approve match
        wait_after: 0

  # Scenario 14: Driver updates routine after hitchhiker already requested
  - id: 14
    name: "Driver Updates Routine After Request"
    description: "Driver updates routine destination after hitchhiker already requested, should still match"
    users:
      - user_id: "driver_014"
        phone: "0532222222"
        type: "driver"
        setup_messages:
          - "היי"
          - "אור נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "חיפה"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_014"
        phone: "0533333333"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "יונתן טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_014"
        phone: "0533333333"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "תל אביב"  # Different destination initially
        wait_after: 0
        
      - user_id: "driver_014"
        phone: "0532222222"
        type: "driver"
        action_messages:
          - "שלום"  # Trigger menu
          - "2"  # Update routine
          - "1"  # Has routine
          - "תל אביב"  # Update to match hitchhiker's request
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
        wait_after: 0
        
      - user_id: "driver_014"
        phone: "0532222222"
        type: "driver"
        action_messages:
          - "1"  # Approve match (should now match)
        wait_after: 0

  # Scenario 15: Hitchhiker requests ride at different time ranges
  - id: 15
    name: "Different Time Ranges"
    description: "Hitchhiker requests ride at different time ranges (now, half hour, hour, 2-5 hours)"
    users:
      - user_id: "driver_015"
        phone: "0534444444"
        type: "driver"
        setup_messages:
          - "היי"
          - "אליעזר נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "ירושלים"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_015a"
        phone: "0535555555"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אלון טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_015a"
        phone: "0535555555"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "2"  # Half hour
          - "ירושלים"
        wait_after: 0
        
      - user_id: "hitchhiker_015b"
        phone: "0536666666"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אור טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_015b"
        phone: "0536666666"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "3"  # One hour
          - "ירושלים"
        wait_after: 0
        
      - user_id: "hitchhiker_015c"
        phone: "0537777777"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "איתי טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_015c"
        phone: "0537777777"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "4"  # 2-5 hours
          - "ירושלים"
        wait_after: 0
        
      - user_id: "driver_015"
        phone: "0534444444"
        type: "driver"
        action_messages:
          - "1"  # Approve first match
        wait_after: 0

  # Scenario 16: Driver with weekend routine (Friday-Saturday)
  - id: 16
    name: "Weekend Routine"
    description: "Driver with weekend routine, hitchhiker requests ride on weekend"
    users:
      - user_id: "driver_016"
        phone: "0538888888"
        type: "driver"
        setup_messages:
          - "היי"
          - "אליה נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "חיפה"
          - "ה,ו"  # Thursday, Friday
          - "10:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_016"
        phone: "0539999999"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אליאור טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_016"
        phone: "0539999999"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "חיפה"
        wait_after: 0
        
      - user_id: "driver_016"
        phone: "0538888888"
        type: "driver"
        action_messages:
          - "1"  # Approve match
        wait_after: 0

  # Scenario 17: Driver with "ask" preference approves sharing name
  - id: 17
    name: "Driver Ask Preference - Approves Sharing"
    description: "Driver with 'ask' preference approves sharing name when asked"
    users:
      - user_id: "driver_017"
        phone: "0541111111"
        type: "driver"
        setup_messages:
          - "היי"
          - "אלירן נהג"
          - "3"  # Driver
          - "1"
          - "ירושלים"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference
          - "2"  # Share name preference: ask
        wait_after: 0
        
      - user_id: "hitchhiker_017"
        phone: "0542222222"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אליה טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_017"
        phone: "0542222222"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "ירושלים"
        wait_after: 0
        
      - user_id: "driver_017"
        phone: "0541111111"
        type: "driver"
        action_messages:
          - "1"  # Approve match
          - "share_name_yes_"  # Approve sharing name
        wait_after: 0
        
      - user_id: "hitchhiker_017"
        phone: "0542222222"
        type: "hitchhiker"
        action_messages:
          - "שלום"  # Check notification (should have name)
        wait_after: 0

  # Scenario 18: Driver with "ask" preference rejects sharing name
  - id: 18
    name: "Driver Ask Preference - Rejects Sharing"
    description: "Driver with 'ask' preference rejects sharing name when asked"
    users:
      - user_id: "driver_018"
        phone: "0543333333"
        type: "driver"
        setup_messages:
          - "היי"
          - "אליעזר נהג"
          - "3"  # Driver
          - "1"
          - "ירושלים"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference
          - "2"  # Share name preference: ask
        wait_after: 0
        
      - user_id: "hitchhiker_018"
        phone: "0544444444"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אליהו טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_018"
        phone: "0544444444"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "ירושלים"
        wait_after: 0
        
      - user_id: "driver_018"
        phone: "0543333333"
        type: "driver"
        action_messages:
          - "1"  # Approve match
          - "share_name_no_"  # Reject sharing name
        wait_after: 0
        
      - user_id: "hitchhiker_018"
        phone: "0544444444"
        type: "hitchhiker"
        action_messages:
          - "שלום"  # Check notification (should have phone but no name)
        wait_after: 0

  # Scenario 19: Multiple hitchhikers, one driver
  - id: 19
    name: "Multiple Hitchhikers One Driver"
    description: "Multiple hitchhikers request ride to same destination, driver approves one"
    users:
      - user_id: "driver_019"
        phone: "0545555555"
        type: "driver"
        setup_messages:
          - "היי"
          - "אליה נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "ירושלים"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_019a"
        phone: "0546666666"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אליהו טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_019b"
        phone: "0547777777"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אלירן טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_019a"
        phone: "0546666666"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "ירושלים"
        wait_after: 0
        
      - user_id: "hitchhiker_019b"
        phone: "0547777777"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "ירושלים"
        wait_after: 0
        
      - user_id: "driver_019"
        phone: "0545555555"
        type: "driver"
        action_messages:
          - "1"  # Approve first match (should approve first hitchhiker)
        wait_after: 0

  # Scenario 20: Driver with very early morning routine
  - id: 20
    name: "Early Morning Routine"
    description: "Driver with very early morning routine (05:00), hitchhiker requests ride"
    users:
      - user_id: "driver_020"
        phone: "0548888888"
        type: "driver"
        setup_messages:
          - "היי"
          - "אליהו נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "ירושלים"
          - "א-ה"
          - "05:00"  # Very early
          - "15:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_020"
        phone: "0549999999"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אליה טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_020"
        phone: "0549999999"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "ירושלים"
        wait_after: 0
        
      - user_id: "driver_020"
        phone: "0548888888"
        type: "driver"
        action_messages:
          - "1"  # Approve match
        wait_after: 0

  # Scenario 21: Driver with late evening routine
  - id: 21
    name: "Late Evening Routine"
    description: "Driver with late evening routine (22:00), hitchhiker requests ride"
    users:
      - user_id: "driver_021"
        phone: "0551111111"
        type: "driver"
        setup_messages:
          - "היי"
          - "אליהו נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "ירושלים"
          - "א-ה"
          - "22:00"  # Late evening
          - "23:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_021"
        phone: "0552222222"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אליה טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_021"
        phone: "0552222222"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "ירושלים"
        wait_after: 0
        
      - user_id: "driver_021"
        phone: "0551111111"
        type: "driver"
        action_messages:
          - "1"  # Approve match
        wait_after: 0

  # Scenario 22: Driver with single day routine
  - id: 22
    name: "Single Day Routine"
    description: "Driver with routine on single day only, hitchhiker requests ride"
    users:
      - user_id: "driver_022"
        phone: "0553333333"
        type: "driver"
        setup_messages:
          - "היי"
          - "אליהו נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "ירושלים"
          - "ב"  # Tuesday only
          - "07:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_022"
        phone: "0554444444"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אליה טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_022"
        phone: "0554444444"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "ירושלים"
        wait_after: 0
        
      - user_id: "driver_022"
        phone: "0553333333"
        type: "driver"
        action_messages:
          - "1"  # Approve match
        wait_after: 0

  # Scenario 23: Driver with "all alerts" preference gets notification for non-matching destination
  - id: 23
    name: "All Alerts Preference"
    description: "Driver with 'all alerts' preference gets notification even for non-matching destination"
    users:
      - user_id: "driver_023"
        phone: "0555555555"
        type: "driver"
        setup_messages:
          - "היי"
          - "אליהו נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "ירושלים"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "1"  # Alert preference: all requests
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_023"
        phone: "0556666666"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אליה טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_023"
        phone: "0556666666"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "אילת"  # Different destination
        wait_after: 0
        
      - user_id: "driver_023"
        phone: "0555555555"
        type: "driver"
        action_messages:
          - "1"  # Approve match (should receive notification even though destination doesn't match)
        wait_after: 0

  # Scenario 24: Driver with "destinations only" preference doesn't get notification for non-matching destination
  - id: 24
    name: "Destinations Only Alert Preference"
    description: "Driver with 'destinations only' preference doesn't get notification for non-matching destination"
    users:
      - user_id: "driver_024"
        phone: "0557777777"
        type: "driver"
        setup_messages:
          - "היי"
          - "אליהו נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "ירושלים"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "2"  # Alert preference: only my destinations
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_024"
        phone: "0558888888"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אליה טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_024"
        phone: "0558888888"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now
          - "אילת"  # Different destination - driver shouldn't get notification
        wait_after: 0

  # Scenario 25: Driver with "destinations + time" preference gets notification only for matching destination and time
  - id: 25
    name: "Destinations And Time Alert Preference"
    description: "Driver with 'destinations + time' preference gets notification only for matching destination and time"
    users:
      - user_id: "driver_025"
        phone: "0559999999"
        type: "driver"
        setup_messages:
          - "היי"
          - "אליהו נהג"
          - "תל אביב"
          - "3"
          - "1"
          - "ירושלים"
          - "א-ה"
          - "07:00"
          - "18:00"
          - "2"
          - "3"  # Alert preference: destinations + time
          - "1"  # Share name preference: always
        wait_after: 0
        
      - user_id: "hitchhiker_025"
        phone: "0561111111"
        type: "hitchhiker"
        setup_messages:
          - "שלום"
          - "אליה טרמפיסט"
          - "רמת גן"
          - "2"
          - "2"
          - "2"
        wait_after: 0
        
      - user_id: "hitchhiker_025"
        phone: "0561111111"
        type: "hitchhiker"
        action_messages:
          - "שלום"
          - "1"  # Looking for ride
          - "1"  # Now (should match driver's time window)
          - "ירושלים"  # Matching destination
        wait_after: 0
        
      - user_id: "driver_025"
        phone: "0559999999"
        type: "driver"
        action_messages:
          - "1"  # Approve match
        wait_after: 0
