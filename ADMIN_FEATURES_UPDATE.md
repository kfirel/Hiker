# 🚀 עדכון תכונות ניהול - ינואר 2026

## ✨ תכונות חדשות

### 1️⃣ היסטוריית צ'אט מלאה (100 הודעות)
- **מה השתנה**: הועלה המקסימום מ-20 ל-100 הודעות אחרונות בהיסטוריית הצ'אט
- **איפה**: `config.py` - `MAX_CHAT_HISTORY = 100`
- **ממשק משתמש**: לחיצה על משתמש בטבלת המשתמשים פותחת Modal עם:
  - טאב "היסטוריית צ'אט" - מציג את כל 100 ההודעות האחרונות
  - טאב "פרטים" - מציג מידע מפורט על המשתמש
- **קבצים חדשים**: 
  - `frontend/src/components/Users/UserDetailsModal.jsx`

### 2️⃣ תצוגת מפה לנסיעות
- **מה השתנה**: הוספת Modal שמציג מידע על מסלול נסיעה
- **ממשק משתמש**: לחיצה על נסיעה (נהג או טרמפיסט) פותחת Modal עם:
  - פרטי הנסיעה המלאים
  - מידע על המרחק והמסלול (אם קיים)
  - טווח ההתאמה (threshold) לטרמפיסטים
  - קישור ל-Google Maps
- **קבצים חדשים**: 
  - `frontend/src/components/Rides/RideMapModal.jsx`
- **תלות חדשה**: `leaflet`, `react-leaflet` (במידת הצורך לעתיד)

### 3️⃣ מחיקת משתמש
- **מה השתנה**: הוספת אפשרות למחיקת משתמש ישירות מהממשק
- **ממשק משתמש**: 
  - עמודה חדשה "פעולות" בטבלת המשתמשים
  - כפתור מחיקה (🗑️) לכל משתמש
  - אישור לפני מחיקה
- **Backend**: כבר היה קיים endpoint `DELETE /a/users/{phone_number}`
- **קבצים שעודכנו**: `frontend/src/pages/UsersPage.jsx`

### 4️⃣ נהגים וטרמפיסטים באותו המסך
- **מה השתנה**: 
  - הוסרו הטאבים שהיו בעבר
  - נהגים וטרמפיסטים מוצגים כעת ב-2 טבלאות נפרדות באותו מסך
  - כל טבלה עם כפתור ייצוא נפרד
  - לחיצה על כל נסיעה פותחת את ה-Modal של המפה
- **קבצים שעודכנו**: `frontend/src/pages/RidesPage.jsx`

---

## 📁 קבצים שנוצרו/עודכנו

### קבצים חדשים:
1. `/frontend/src/components/Users/UserDetailsModal.jsx` - Modal להצגת פרטי משתמש והיסטוריית צ'אט
2. `/frontend/src/components/Rides/RideMapModal.jsx` - Modal להצגת מסלול נסיעה על מפה

### קבצים שעודכנו:
1. `/config.py` - הגדלת `MAX_CHAT_HISTORY` ל-100
2. `/frontend/src/pages/UsersPage.jsx`:
   - הוספת `UserDetailsModal`
   - הוספת כפתור מחיקה
   - לחיצה על שורה פותחת את פרטי המשתמש
3. `/frontend/src/pages/RidesPage.jsx`:
   - הסרת טאבים
   - הצגת 2 טבלאות נפרדות (נהגים וטרמפיסטים)
   - הוספת `RideMapModal`
   - לחיצה על נסיעה פותחת את המפה
4. `/frontend/package.json`:
   - הוספת `leaflet` ו-`react-leaflet`

---

## 🚀 איך להשתמש בתכונות החדשות?

### 1. לראות היסטוריית צ'אט של משתמש:
   - היכנס לעמוד "משתמשים"
   - לחץ על שורה של משתמש
   - התצוגה תפתח עם 2 טאבים:
     - **היסטוריית צ'אט**: כל ההודעות (עד 100 אחרונות)
     - **פרטים**: מידע כללי על המשתמש

### 2. לראות מסלול נסיעה:
   - היכנס לעמוד "נסיעות"
   - לחץ על כל נסיעה (נהג או טרמפיסט)
   - תיפתח תצוגה עם:
     - פרטי הנסיעה המלאים
     - מידע על המרחק והמסלול
     - אפשרות לפתוח ב-Google Maps

### 3. למחוק משתמש:
   - היכנס לעמוד "משתמשים"
   - לחץ על כפתור 🗑️ בעמודה "פעולות"
   - אשר את המחיקה
   - **⚠️ זהירות**: המחיקה היא סופית!

### 4. לראות את כל הנסיעות:
   - היכנס לעמוד "נסיעות"
   - תראה 2 טבלאות:
     - **נהגים פעילים** (רקע כחול)
     - **טרמפיסטים פעילים** (רקע ירוק)
   - ניתן לייצא כל טבלה בנפרד

---

## 🔄 איך לעדכן את הממשק בענן?

### אופציה 1: דרך Google Cloud Console (פשוט יותר)
1. פתח את [Google Cloud Console](https://console.cloud.google.com)
2. עבור ל-Cloud Build → Triggers
3. הרץ את ה-trigger הקיים או צור חדש
4. הבילד יכלול אוטומטית את כל השינויים החדשים

### אופציה 2: דרך Cloud Shell
```bash
# 1. Clone/Pull the repository
cd /path/to/Hiker

# 2. Build and deploy
gcloud builds submit --tag gcr.io/YOUR_PROJECT_ID/hiker
gcloud run deploy hiker \
  --image gcr.io/YOUR_PROJECT_ID/hiker \
  --platform managed \
  --region europe-west1 \
  --set-env-vars GOOGLE_CLOUD_PROJECT=YOUR_PROJECT_ID,ADMIN_TOKEN=YOUR_ADMIN_TOKEN
```

---

## 📝 הערות טכניות

### ביצועים:
- היסטוריית הצ'אט נשמרת עד 100 הודעות (במקום 20)
- ה-AI ממשיך לקבל רק את הכמות הרלוונטית (לפי ההגדרות)

### תאימות:
- כל התכונות תואמות למבנה ה-API הקיים
- אין צורך בשינויים ב-Backend (מלבד `MAX_CHAT_HISTORY`)

### אבטחה:
- מחיקת משתמש דורשת אישור
- כל הפעולות דורשות authentication עם `ADMIN_TOKEN`

---

## 🐛 בעיות ידועות ופתרונות

### 1. "לא נמצאו נסיעות"
- ודא שיש נסיעות פעילות במערכת
- בדוק את הסינון לפי יעד

### 2. "שגיאה בטעינת היסטוריה"
- ודא שה-Backend רץ
- בדוק ש-`ADMIN_TOKEN` תקין

### 3. "המפה לא נטענת"
- בגרסה הנוכחית, המפה מציגה מידע ולינק ל-Google Maps
- בעתיד ניתן להוסיף מפה אינטראקטיבית

---

## 📞 תמיכה

אם יש בעיה או שאלה:
1. בדוק את הלוגים ב-Google Cloud Console
2. ודא ש-`ADMIN_TOKEN` נכון
3. ודא שה-Frontend נבנה מחדש (`npm run build`)

---

**תאריך עדכון**: 3 ינואר 2026
**גרסה**: 2.1.0

